<!-- ğŸ“„ templates/profile_edit.html -->
<!DOCTYPE html>
<html lang="ko">
<head>
  <!-- í˜ì´ì§€ ê¸°ë³¸ ì„¤ì • ë° ì™¸ë¶€ ìŠ¤íƒ€ì¼ -->
  <meta charset="UTF-8" />
  <title>í”„ë¡œí•„ í¸ì§‘</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col items-center py-10">
  <!-- í˜ì´ì§€ íƒ€ì´í‹€ -->
  <h1 class="text-3xl font-bold text-green-600 mb-8">í”„ë¡œí•„ í¸ì§‘</h1>

  <!-- í”„ë¡œí•„ í¸ì§‘ í¼ -->
  <form class="w-full max-w-md bg-white p-6 rounded shadow space-y-4" method="POST" onsubmit="submitEdit(event)">
    <!-- ì‚¬ìš©ì ì •ë³´ ì…ë ¥ í•„ë“œ -->
    <div>
      <label class="block font-semibold mb-1">ì´ë¦„ (ìˆ˜ì • ë¶ˆê°€)</label>
      <input type="text" value="{{ user.user_name }}" disabled class="w-full border p-2 rounded bg-gray-100" />
    </div>
    <div>
      <label class="block font-semibold mb-1">ì•„ì´ë””</label>
      <input type="text" id="user_id" value="{{ user.user_id }}" class="w-full border p-2 rounded" />
    </div>
    <div>
      <label class="block font-semibold mb-1">ì´ë©”ì¼</label>
      <input type="email" id="email" value="{{ user.user_email }}" class="w-full border p-2 rounded" />
    </div>
    <div>
      <label class="block font-semibold mb-1">ìƒˆ ë¹„ë°€ë²ˆí˜¸</label>
      <input type="password" id="password" class="w-full border p-2 rounded" />
    </div>
    <div>
      <label class="block font-semibold mb-1">ë¹„ë°€ë²ˆí˜¸ í™•ì¸</label>
      <input type="password" id="confirm" class="w-full border p-2 rounded" />
    </div>

    <!-- í¼ ì•¡ì…˜ ë²„íŠ¼ -->
    <div class="flex justify-between mt-6">
      <a href="/profile" class="text-sm text-gray-500 hover:underline">â† ëŒì•„ê°€ê¸°</a>
      <button type="submit" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">ìˆ˜ì • ì™„ë£Œ</button>
    </div>
  </form>

  <!-- í”„ë¡œí•„ í¸ì§‘ ê¸°ëŠ¥ ìŠ¤í¬ë¦½íŠ¸ -->
  <script>
    async function submitEdit(event) {
      event.preventDefault();
      const user_id = document.getElementById("user_id").value;
      const email = document.getElementById("email").value;
      const password = document.getElementById("password").value;
      const confirm = document.getElementById("confirm").value;

      if (password && password !== confirm) {
        return alert("ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.");
      }

      const res = await fetch("/profile_edit", {
        method: "POST",
        headers: { 
            "Content-Type": "application/json",
            "X-CSRF-TOKEN": csrfToken
        },
        body: JSON.stringify({ user_id, email, password }),
        credentials: "include"
      });

      const result = await res.json();
      alert(result.msg);
      if (result.success) window.location.href = "/profile";
    }

    function getCookie(name) {
        const value = `; ${document.cookie}`;
        const parts = value.split(`; ${name}=`);
        if (parts.length === 2) return parts.pop().split(';').shift();
    }
    const csrfToken = getCookie("csrf_access_token");
  </script>
</body>
</html>
